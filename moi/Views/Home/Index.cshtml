@model List<moi.Models.SanPham>
@{
    Layout = "~/Views/Shared/_LayoutCustomer.cshtml";
    ViewBag.Title = "Trang chủ";
}

<div class="banner">
    <img src="~/Content/HinhAnhBanner/banner1.jpg" alt="Banner nhà hàng" class="banner-img" />
</div>

<div class="container py-5">
    <h2 class="text-danger fw-bold mb-4 text-center">
        <i class="fas fa-hamburger"></i> THỰC ĐƠN NỔI BẬT
    </h2>

    @if (Model == null || !Model.Any())
    {
        <div class="alert alert-warning text-center">
            <i class="fas fa-exclamation-triangle"></i> Hiện chưa có sản phẩm nào!
        </div>
    }
    else
    {
        <div class="row g-4">
            @foreach (var sp in Model)
            {
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="card h-100 shadow-sm hover-card">
                        <div class="position-relative">
                            <img src="~/Content/HinhAnhSP/@sp.Anh"
                                 class="card-img-top"
                                 style="height:200px; object-fit:cover;"
                                 alt="@sp.TenSP"
                                 onerror="this.src='~/Content/HinhAnhSP/default.jpg';" />
                            @if (sp.SoLuong <= 0)
                            {
                                <span class="badge bg-danger position-absolute top-0 end-0 m-2">
                                    Hết hàng
                                </span>
                            }
                        </div>
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title text-truncate" title="@sp.TenSP">
                                @sp.TenSP
                            </h5>
                            <p class="card-text text-muted small flex-grow-1">
                                @(sp.MoTa ?? "Sản phẩm ngon, chất lượng!")
                            </p>
                            <div class="d-flex justify-content-between align-items-center mt-auto">
                                <h5 class="text-danger fw-bold mb-0">
                                    @String.Format("{0:N0}", sp.Gia ?? 0) đ
                                </h5>
                                @if (sp.SoLuong > 0)
                                {
                                    <button class="btn btn-danger btn-sm btn-add-cart"
                                            data-id="@sp.MaSP"
                                            data-name="@sp.TenSP">
                                        <i class="fas fa-cart-plus"></i>
                                    </button>
                                }
                                else
                                {
                                    <button class="btn btn-secondary btn-sm" disabled>
                                        <i class="fas fa-ban"></i>
                                    </button>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>

<style>
    .banner {
        width: 100%;
        margin-bottom: 0;
    }

    .banner-img {
        width: 100%;
        height: 500px;
        object-fit: cover;
        display: block;
    }

    .hover-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

        .hover-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2) !important;
        }
</style>

@section scripts {
    <script>
        $('.btn-add-cart').click(function () {
            var maSP = $(this).data('id');
            var tenSP = $(this).data('name');
            var btn = $(this);

            // Kiểm tra đăng nhập
            @if (Session["MaTK"] == null)
            {
                <text>
                if (confirm('Bạn cần đăng nhập để thêm vào giỏ hàng. Đăng nhập ngay?')) {
                    window.location.href = '@Url.Action("Login", "Account", new { returnUrl = Url.Action("Index", "Home") })';
                }
                return;
                </text>
            }

            btn.prop('disabled', true).html('<i class="fas fa-spinner fa-spin"></i>');

            $.post('@Url.Action("ThemVaoGio", "Cart")', { maSP: maSP, soLuong: 1 })
                .done(function (res) {
                    if (res.success) {
                        // Hiển thị thông báo thành công
                        var toast = $('<div class="alert alert-success alert-dismissible fade show position-fixed" style="top:80px; right:20px; z-index:9999;" role="alert">' +
                            '<i class="fas fa-check-circle"></i> Đã thêm <strong>' + tenSP + '</strong> vào giỏ hàng!' +
                            '<button type="button" class="btn-close" data-bs-dismiss="alert"></button>' +
                            '</div>');
                        $('body').append(toast);
                        setTimeout(() => toast.remove(), 3000);
                    } else {
                        alert(res.message || 'Có lỗi xảy ra!');
                    }
                })
                .fail(function () {
                    alert('Lỗi kết nối server!');
                })
                .always(function () {
                    btn.prop('disabled', false).html('<i class="fas fa-cart-plus"></i>');
                });
        });
    </script>
}